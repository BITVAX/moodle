{"version":3,"file":"script.min.js","sources":["../src/script.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *  Sharing Cart\n *\n *  @package    block_sharing_cart\n *  @copyright  2017 (C) VERSION2, INC.\n *  @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/modal_factory', 'core/modal_events'], function($, ModalFactory, ModalEvents) {\n    return {\n        init: function(addMethod) {\n\n            $(document).ready(function() {\n                let isDragging = false;\n\n                /**\n                 *  Returns a localized string\n                 *\n                 *  @param {String} identifier\n                 *  @return {String}\n                 */\n                function str(identifier) {\n                    return M.str.block_sharing_cart[identifier] || M.str.moodle[identifier];\n                }\n\n                /**\n                 *  Get an action URL\n                 *\n                 *  @param {String} name   The action name\n                 *  @param {Object} [args] The action parameters\n                 *  @return {String}\n                 */\n                function get_action_url(name, args) {\n                    var url = M.cfg.wwwroot + '/blocks/sharing_cart/' + name + '.php';\n                    if (args) {\n                        var q = [];\n                        for (var k in args) {\n                            q.push(k + '=' + encodeURIComponent(args[k]));\n                        }\n                        url += '?' + q.join('&');\n                    }\n                    return url;\n                }\n\n                /**\n                 *  Shake the basket to indicate cancel/submit\n                 */\n                function shake_basket() {\n                    if (addMethod === 'drag_and_drop') {\n                        const sharingCartBasket = document.querySelector('button.sharing_cart_basket');\n                        sharingCartBasket?.classList.add('shake_basket');\n                    }\n                }\n\n                /**\n                 *  Remove the shake effect and basket icon\n                 */\n                function remove_basket() {\n                    if (addMethod === 'drag_and_drop' && !isDragging) {\n                        const footer = document.getElementById('page-footer');\n                        const footerIconContainer = footer.querySelector('div[data-region=\"footer-container-popover\"]');\n                        const sharingCartBasket = document.querySelector('button.sharing_cart_basket');\n\n                        if (sharingCartBasket) {\n                            footerIconContainer?.removeChild(sharingCartBasket);\n                            sharingCartBasket.classList.remove('shake_basket');\n                        }\n                    }\n                }\n\n                /**\n                 * Modal called when confirming an action.\n                 *\n                 * @param obj\n                 */\n                function confirm_modal(obj) {\n\n                    // Checkbox for copying userdata confirmation.\n                    if (obj.checkbox) {\n                        obj.body +=\n                            '<div class=\"modal-checbox-wrapper modal-sharing_cart\">' +\n                            '<input type=\"checkbox\" id=\"modal-checkbox\" class=\"modal-checkbox\">' +\n                            '<label for=\"modal-checkbox\">' + str('modal_checkbox') + '</label>' +\n                            '</div>';\n                    }\n\n\n                    ModalFactory.create({\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        title: obj.title,\n                        body: obj.body,\n                    }).done(function(modal) {\n                        let is_submitted = false;\n                        modal.setSaveButtonText(obj.save_button);\n\n                        // On save save check - if checkbox is checked.\n                        modal.getRoot().on(ModalEvents.save, function(e) {\n\n                            var response = {\n                                'checkbox': $(e.target).find('.modal-checkbox').is(':checked'),\n                            };\n\n                            obj.next(response);\n                            is_submitted = true;\n                        });\n\n                        modal.getRoot().on(ModalEvents.cancel, function() {\n                            remove_basket();\n                        });\n\n                        // Remove modal from html.\n                        modal.getRoot().on(ModalEvents.hidden, function() {\n                            $('body').removeClass('modal-open');\n\n                            if (!is_submitted) {\n                                remove_basket();\n                            }\n                        });\n\n                        modal.show();\n                    });\n                }\n\n                /**\n                 * Get the section name from the section when\n                 * it's changed with the in place editor\n                 *\n                 * @param $section\n                 * @returns {*}\n                 */\n                function in_place_edit_section_name($section) {\n                    var sectionName = '';\n                    var $inPlaceEditable = $section.find('h3.sectionname .inplaceeditable');\n                    if ($inPlaceEditable.length) {\n                        sectionName = $inPlaceEditable.data('value');\n                    }\n                    return sectionName;\n                }\n\n                /**\n                 * @param post_data\n                 * @param title_str\n                 * @param body_str\n                 * @param isSection\n                 */\n                function on_backup_modal(post_data, title_str, body_str, isSection) {\n                    (function(on_success) {\n                        $.post(get_action_url('rest'), post_data,\n                            function(response) {\n                                on_success(response);\n                            }, \"text\")\n                            .fail(function(response) {\n                                show_error(response);\n                            });\n                    })(function(response) {\n                        var copyable = response === '1';\n                        var checkbox = false;\n\n                        if (copyable) {\n                            checkbox = true;\n                        }\n\n                        confirm_modal({\n                            'title': title_str,\n                            'body': body_str,\n                            'save_button': str('modal_confirm_backup'),\n                            'checkbox': checkbox,\n                            'next': function(data) {\n                                if (isSection === true) {\n                                    backup_section(post_data.sectionid, post_data.sectionnumber, post_data.courseid, data.checkbox);\n                                } else {\n                                    backup(post_data.cmid, data.checkbox);\n                                }\n\n                                shake_basket();\n                            }\n                        });\n                    });\n                }\n\n                /** @var {Object}  The icon configurations */\n                var icon = {\n                    // Actions\n                    'backup': {\n                        css: 'editing_backup',\n                        iconClass: 'fa fa-frown-o',\n                    },\n                    'movedir': {\n                        css: 'editing_right',\n                        iconClass: 'fa fa-arrow-right',\n                    },\n                    'move': {\n                        css: 'editing_move_',\n                        iconClass: 'fa fa-arrows-v',\n                    },\n                    'edit': {\n                        css: 'editing_update',\n                        iconClass: 'fa fa-pencil',\n                    },\n                    'cancel': {\n                        css: 'editing_cancel',\n                        iconClass: 'fa fa-ban',\n                    },\n                    'delete': {\n                        css: 'editing_update',\n                        iconClass: 'fa fa-trash',\n                    },\n                    'restore': {\n                        css: 'editing_restore',\n                        iconClass: 'fa fa-clone',\n                    },\n                    // Directories\n                    'dir-open': {\n                        iconClass: 'fa fa-folder-open-o'\n                    },\n                    'dir-closed': {\n                        iconClass: 'fa fa-folder-o'\n                    },\n                };\n\n                /** @var {Node}  The Sharing Cart block container node */\n                var $block = $('.block_sharing_cart');\n\n                /** @var {Object}  The current course */\n                var course = new function() {\n                    var body = $('body');\n                    this.id = body.attr('class').match(/course-(\\d+)/)[1];\n                    this.is_frontpage = body.hasClass('pagelayout-frontpage');\n                }();\n\n                /**\n                 *  Shows an error message with given Ajax error\n                 *\n                 *  @param {Object} response  The Ajax response\n                 */\n                function show_error(response) {\n                    try {\n                        var ex = JSON.parse(response.responseText);\n                        new M.core.exception({\n                            name: str('pluginname') + ' - ' + str('error'),\n                            message: ex.message\n                        });\n                    } catch (e) {\n                        new M.core.exception({\n                            name: str('pluginname') + ' - ' + str('error'),\n                            message: response.responseText\n                        });\n                    }\n                }\n\n                /**\n                 *  Check special layout (theme boost)\n                 *\n                 *  @return {Boolean}\n                 */\n                function verify_layout() {\n                    var menuelement = $block.find('.menubar .dropdown .dropdown-menu');\n                    return (menuelement.length);\n                }\n\n                /**\n                 * Set Cookie\n                 * @param name\n                 * @param value\n                 * @param expireTimeInMillisecond\n                 */\n                function setCookie(name, value, expireTimeInMillisecond) {\n                    var d = new Date();\n                    d.setTime(d.getTime() + expireTimeInMillisecond);\n                    var expires = 'expires=' + d.toUTCString();\n                    document.cookie = name + '=' + value + ';' + expires + '';\n                }\n\n                /**\n                 * Get Cookie Value\n                 * @param param\n                 * @returns {*}\n                 */\n                function getCookieValue(param) {\n                    var readCookie = document.cookie.match('(^|;)\\\\s*' + param + '\\\\s*=\\\\s*([^;]+)');\n                    return readCookie ? readCookie.pop() : '';\n                }\n\n                /**\n                 * Create a command icon\n                 *\n                 *  @param {String} name  The command name, predefined in icon\n                 *  @param {String} [pix] The icon pix name to override\n                 */\n                function create_command(name) {\n                    var iconElement = $('<i/>')\n                        .attr('alt', str(name))\n                        .attr('class', icon[name].iconClass);\n                    // If (verify_layout()) {\n                    //     iconElement.addClass('iconcustom');\n                    // }\n\n                    return $('<a href=\"javascript:void(0)\"/>')\n                        .addClass(icon[name].css)\n                        .attr('title', str(name))\n                        .append(iconElement);\n                }\n\n                /**\n                 * Create a spinner\n                 * @param $node\n                 * @returns {*|jQuery}\n                 */\n                function add_spinner() {\n                    var $spinner = ($('<div class=\"block_spinner\"><i class=\"fa fa-shopping-basket sharing_cart_basket shake_basket fa-2x\"></i></div>'));\n                    $('section.block_sharing_cart').append($spinner);\n                    return $spinner;\n                }\n\n                /**\n                 *\n                 * @param $node\n                 * @returns {jQuery.fn.init}\n                 */\n                function add_node_spinner($node) {\n                    var $node_spinner = $('<i class=\"fa fa-circle-o-notch fa-spin node_spinner node_spinner-sharing_cart\"></i>');\n                    $node.append($node_spinner);\n                    return $node_spinner;\n                }\n\n                $(document).on('click', 'a.restore', function() {\n                    add_spinner();\n                });\n\n                /**\n                 *\n                 *  Reload the Sharing Cart item tree\n                 */\n                function reload_tree() {\n                    $.post(get_action_url(\"rest\"),\n                        {\n                            \"action\": \"render_tree\",\n                            \"courseid\": course.id\n                        },\n                        function(response) {\n                            $block.find(\".tree\").replaceWith($(response));\n                            $.init_item_tree();\n                        }, \"html\")\n                        .fail(function(response) {\n                            show_error(response);\n                        });\n                }\n\n                /**\n                 *  Backup an activity\n                 *\n                 *  @param {int} cmid\n                 *  @param {Boolean} userdata\n                 */\n                function backup(cmid, userdata) {\n                    var $commands = $('#module-' + cmid + ' .actions');\n                    if (!$commands.length) {\n                        $commands = $('[data-owner=\"#module-' + cmid + '\"]');\n                    }\n\n                    var $spinner = add_spinner();\n                    var $node_spinner = add_node_spinner($commands);\n\n                    $.post(get_action_url(\"rest\"),\n                        {\n                            \"action\": \"backup\",\n                            \"cmid\": cmid,\n                            \"userdata\": userdata,\n                            \"sesskey\": M.cfg.sesskey,\n                            \"courseid\": course.id\n                        },\n                        function() {\n                            reload_tree();\n                        })\n                        .fail(function(response) {\n                            show_error(response);\n                        })\n                        .always(function() {\n                            $node_spinner.hide();\n                            $spinner.hide();\n                            remove_basket();\n                        });\n                }\n\n                /**\n                 *  Backup an activities in a section\n                 *\n                 *  @param {int} sectionId\n                 *  @param {int} sectionNumber\n                 *  @param {int} courseId\n                 *  @param {Boolean} userdata\n                 */\n                function backup_section(sectionId, sectionNumber, courseId, userdata) {\n                    var $commands = $('span.inplaceeditable[data-itemtype=sectionname][data-itemid=' + sectionId + ']');\n                    var $section = $commands.closest(\"li.section.main\");\n                    var sectionName = $section.attr('aria-label') || $section.find('.sectionname').text().trim();\n\n                    if (sectionName === null) {\n                        sectionName = String($('#region-main .section_action_menu[data-sectionid=\\'' + sectionId + '\\']')\n                            .parent().parent().find('h3.sectionname').text());\n                    }\n\n                    var inPlaceEditSectionName = in_place_edit_section_name($section);\n                    sectionName = (inPlaceEditSectionName !== '') ? inPlaceEditSectionName : sectionName;\n\n                    var $spinner = add_spinner();\n                    var $node_spinner = add_node_spinner($commands);\n\n                    $.post(get_action_url(\"rest\"),\n                        {\n                            \"action\": \"backup_section\",\n                            \"sectionid\": sectionId,\n                            \"sectionnumber\": sectionNumber,\n                            \"courseid\": courseId,\n                            \"sectionname\": sectionName,\n                            \"userdata\": userdata,\n                            \"sesskey\": M.cfg.sesskey\n                        },\n                        function() {\n                            reload_tree();\n                        })\n                        .fail(function(response) {\n                            show_error(response);\n                        })\n                        .always(function() {\n                            $spinner.hide();\n                            $node_spinner.hide();\n                            remove_basket();\n                        });\n                }\n\n\n                // /////// CLASSES /////////\n\n                /**\n                 *  @class Directory states manager\n                 */\n                var directories = new function() {\n                    var KEY = 'block_sharing_cart-dirs';\n\n                    var opens = getCookieValue(KEY).split(',').map(function(v) {\n                        return parseInt(v);\n                    });\n\n                    function save() {\n                        var expires = new Date();\n                        expires.setDate(expires.getDate() + 30);\n                        setCookie(KEY, opens.join(','), expires);\n                    }\n\n                    function open($dir, visible) {\n                        var iconIndex = visible ? 'dir-open' : 'dir-closed';\n                        var iconElement = icon[iconIndex].iconClass;\n                        $dir.find('> div i.icon').attr('class', 'icon ' + iconElement);\n                        $dir.find('> ul.list')[visible ? 'show' : 'hide']();\n                    }\n\n                    function toggle(e) {\n                        var $dir = $(e.target).closest('li.directory');\n                        var i = $dir.attr('id').match(/(\\d+)$/)[1];\n                        var v = $dir.find('> ul.list').css('display') === 'none';\n\n                        open($dir, v);\n                        opens[i] = v ? 1 : 0;\n                        save();\n                    }\n\n                    /**\n                     *  Initialize directory states\n                     */\n                    this.init = function() {\n                        var i = 0;\n                        $block.find('li.directory').each(function(index, dir) {\n                            var $dir = $(dir);\n                            $dir.attr('id', 'block_sharing_cart-dir-' + i);\n                            if (i >= opens.length) {\n                                opens.push(0);\n                            } else if (opens[i]) {\n                                open($dir, true);\n                            }\n                            $dir.find('> div div.toggle-wrapper').css('cursor', 'pointer').on('click', function(e) {\n                                toggle(e);\n                            });\n                            i++;\n                        });\n                    };\n\n                    /**\n                     *  Reset directory states\n                     */\n                    this.reset = function() {\n                        opens = [];\n                        this.init();\n                        save();\n                    };\n                }();\n\n                /**\n                 *  @class Targets for moving an item directory\n                 */\n                var move_targets = new function() {\n                    var $cancel = null,\n                        targets = [];\n\n                    /**\n                     *  Hide move targets\n                     */\n                    this.hide = function() {\n                        if ($cancel !== null) {\n                            var $commands = $cancel.closest('.commands');\n                            $cancel.remove();\n                            $cancel = null;\n                            $commands.closest('li.activity').css('opacity', 1.0);\n                            $commands.find('a').each(function() {\n                                $(this).show();\n                            });\n                            $.each(targets, function(index, $target) {\n                                $target.remove();\n                            });\n                            targets = [];\n                        }\n                    };\n\n                    /**\n                     *  Show move targets for a given item\n                     *\n                     *  @param {int} id  The item ID\n                     */\n                    this.show = function(item_id) {\n                        this.hide();\n\n                        function move(e) {\n\n                            var m = $(e.target).closest('a').attr('class').match(/move-(\\d+)-to-(\\d+)/);\n                            var item_id = m[1],\n                                area_to = m[2];\n\n                            var $spinner = add_spinner();\n                            $.post(get_action_url(\"rest\"),\n                                {\n                                    \"action\": \"move\",\n                                    \"item_id\": item_id,\n                                    \"area_to\": area_to,\n                                    \"sesskey\": M.cfg.sesskey\n                                },\n                                function() {\n                                    reload_tree();\n                                })\n                                .fail(function(response) {\n                                    show_error(response);\n                                })\n                                .always(function() {\n                                    $spinner.hide();\n                                });\n                        }\n\n                        var $current = $block.find('#block_sharing_cart-item-' + item_id);\n                        var $next = $current.next();\n                        var $list = $current.closest('ul');\n\n                        var next_id = 0;\n                        if ($next.length) {\n                            next_id = $next.attr('id').match(/item-(\\d+)$/)[1];\n                        }\n\n                        /**\n                         *\n                         * @param item_id\n                         * @param area_to\n                         * @returns {jQuery}\n                         */\n                        function create_target(item_id, area_to) {\n                            var $anchor = $('<a href=\"javascript:void(0)\"/>')\n                                .addClass('move-' + item_id + '-to-' + area_to)\n                                .attr('title', str('movehere'))\n                                .append(\n                                    $('<p>' + str('clicktomove') + '</p>')\n                                        .attr('alt', str('movehere'))\n                                );\n\n                            var $target = $('<li class=\"activity move-to\"/>')\n                                .append($anchor);\n                            $anchor.on('click', function(e) {\n                                move(e);\n                            });\n\n                            return $target;\n                        }\n\n                        $list.find('> li.activity').each(function(index, item) {\n                            var $item = $(item);\n                            var to = $item.attr('id').match(/item-(\\d+)$/)[1];\n                            if (to === item_id) {\n                                $cancel = create_command('cancel', 't/left');\n                                $cancel.on('click', function() {\n                                    move_targets.hide();\n                                });\n                                var $commands = $item.find('.commands');\n                                $commands.find('a').each(function() {\n                                    $(this).hide();\n                                });\n                                $commands.append($cancel);\n                                $item.css('opacity', 0.5);\n                            } else if (to !== next_id) {\n                                var $target = create_target(item_id, to);\n                                $item.before($target);\n                                targets.push($target);\n                            }\n                        }, this);\n\n                        if ($next) {\n                            var $target = create_target(item_id, 0);\n                            $list.append($target);\n                            targets.push($target);\n                        }\n                    };\n                }();\n\n                /**\n                 *  @class Targets for restoring an item\n                 */\n\n                var restore_targets = new function() {\n                    this.is_directory = null;\n                    var $clipboard = null,\n                        targets = [];\n\n                    /**\n                     *\n                     * @param id\n                     * @param section\n                     * @returns {jQuery}\n                     */\n\n                    function create_target(id, section) {\n                        const href = get_action_url('restore', {\n                            'directory': (restore_targets.is_directory === true),\n                            'target': id,\n                            'course': course.id,\n                            'section': section,\n                            'in_section': $('#copy-section-form').data('in-section'),\n                            'sesskey': M.cfg.sesskey,\n                            'returnurl': document.URL,\n                        });\n\n                        let $target = $('<a/>').attr('href', href).attr('title', str('copyhere')).append(\n                            $('<img class=\"move_target\"/>').attr('alt', str('copyhere')).attr('src', M.util.image_url('dropzone_arrow', 'block_sharing_cart'))\n                        );\n\n                        targets.push($target);\n\n                        return $target;\n                    }\n\n                    /**\n                     *  Hide restore targets\n                     */\n                    this.hide = function() {\n                        if ($clipboard !== null) {\n                            $clipboard.remove();\n                            $clipboard = null;\n                            $.each(targets, function(index, $target) {\n                                $target.remove();\n                            });\n                            targets = [];\n                        }\n                    };\n\n                    /**\n                     *\n                     *\n                     *  @param {int} id  The item ID\n                     */\n                    this.show = function(id) {\n                        this.hide();\n\n                        var $view = $(\"<span/>\");\n\n                        if (this.is_directory) {\n                            $view.html(id).css('display', 'inline');\n                            $view.prepend(\n                                $(\"<i/>\").addClass(\"icon\")\n                                    .attr(\"alt\", id)\n                                // .attr(\"src\", M.util.image_url(icon['dir-closed'].pix, null))\n                            );\n                        } else {\n                            var $item = $block.find('#block_sharing_cart-item-' + id);\n                            $view = $($item.find('div')[0].cloneNode(true)).css('display', 'inline');\n                            $view.attr('class', $view.attr('class').replace(/mod-indent-\\d+/, ''));\n                            $view.find('.commands').remove();\n                        }\n\n                        var $cancel = create_command('cancel');\n\n                        $cancel.on('click', this.hide);\n\n                        $clipboard = $('<div class=\"clipboard\"/>');\n                        $clipboard.append(str('clipboard') + \": \").append($view).append($cancel);\n\n                        if (course.is_frontpage) {\n                            var $sitetopic = $('.sitetopic');\n                            var $mainmenu = $('.block_site_main_menu');\n                            if ($sitetopic) {\n                                $sitetopic.find('*').before($clipboard);\n                            } else if ($mainmenu) {\n                                $mainmenu.find('.content').before($clipboard);\n                            }\n\n                            // Mainmenu = section #0, sitetopic = section #1\n                            if ($mainmenu) {\n                                $mainmenu.find('.footer').before(create_target(id, 0));\n                            }\n                            if ($sitetopic) {\n                                $sitetopic.find('ul.section').append(create_target(id, 1));\n                            }\n                        } else {\n                            var $container = $('.course-content');\n                            $container.prepend($clipboard);\n                            $container.find(M.course.format.get_section_wrapper(null)).each(function(index, sectionDOM) {\n                                var $section = $(sectionDOM);\n                                var section = $section.attr('id').match(/(\\d+)$/)[1];\n                                $section.find('ul.section').first().append(create_target(id, section));\n                            }, this);\n                        }\n                    };\n                }();\n\n                // /////// INITIALIZATION /////////\n\n                /**\n                 *\n                 * @returns {string|*}\n                 */\n                $.get_plugin_name = function() {\n                    var $blockheader = $block.find(\"h2\");\n\n                    if (!$blockheader.length) {\n                        $blockheader = $block.find(\"h3\");\n\n                        if ($blockheader.length) {\n                            return $blockheader.html();\n                        }\n                    } else {\n                        return $blockheader.html();\n                    }\n\n                    return \"\";\n                };\n\n                /**\n                 *\n                 * @param e\n                 * @param activityName\n                 * @param {int} cmId\n                 */\n                $.on_backup = function(e, activityName, cmId = 0) {\n                    if (cmId === 0) {\n                        cmId = (function ($backup) {\n                            var $activity = $backup.closest('li.activity');\n                            if ($activity.length) {\n                                return $activity.attr('id').match(/(\\d+)$/)[1];\n                            }\n                            var $commands = $backup.closest('.commands');\n                            var dataowner = $commands.attr('data-owner');\n                            if (dataowner.length) {\n                                return dataowner.match(/(\\d+)$/)[1];\n                            }\n                            return $commands.find('a.editing_delete').attr('href').match(/delete=(\\d+)/)[1];\n                        })($(e.target));\n                    }\n\n                    var data =\n                        {\n                            \"action\": \"is_userdata_copyable\",\n                            \"cmid\": cmId\n                        };\n\n                    on_backup_modal(data, activityName, str('confirm_backup'), false);\n                };\n\n                /**\n                 *  On movedir command clicked\n                 *\n                 *  @param {DOMEventFacade} e\n                 */\n                $.on_movedir = function(e) {\n                    var $commands = $(e.target).closest('.commands');\n\n                    var $current_dir = $commands.closest('li.directory');\n                    var current_path = $current_dir.length ? $current_dir.attr('directory-path') : '/';\n\n                    var item_id = $(e.target).closest('li.activity').attr('id').match(/(\\d+)$/)[1];\n\n                    var dirs = [];\n                    $block.find('li.directory').each(function() {\n                        dirs.push($(this).attr('directory-path'));\n                    });\n\n                    var $form = $('<form/>');\n                    // eslint-disable-next-line no-script-url\n                    $form.attr('action', 'javascript:void(0)');\n\n                    function submit() {\n                        var folder_to = $form.find('[name=\"to\"]').val();\n                        var $spinner = add_spinner();\n                        $.post(get_action_url('rest'),\n                            {\n                                \"action\": \"movedir\",\n                                \"item_id\": item_id,\n                                \"folder_to\": folder_to,\n                                \"sesskey\": M.cfg.sesskey\n                            },\n                            function() {\n                                reload_tree();\n                                directories.reset();\n                            })\n                            .fail(function(response) {\n                                show_error(response);\n                            })\n                            .always(function() {\n                                $spinner.hide();\n                            });\n                    }\n\n                    $form.submit(submit);\n\n                    if (dirs.length === 0) {\n                        var $input = $('<input class=\"form-control\" type=\"text\" name=\"to\"/>').val(current_path);\n                        setTimeout(function() {\n                            $input.focus();\n                        }, 1);\n                        $form.append($input);\n                    } else {\n                        dirs.unshift('/');\n\n                        var $select = $('<select class=\"custom-select\" name=\"to\"/>');\n                        for (var i = 0; i < dirs.length; i++) {\n                            $select.append($('<option/>').val(dirs[i]).append(dirs[i]));\n                        }\n                        $select.val(current_path);\n                        $select.change(submit);\n                        $form.append($select);\n\n                        var $edit = create_command('edit');\n\n                        $edit.on('click', function() {\n                            var $input = $('<input type=\"text\" name=\"to\"/>').val(current_path);\n                            $select.remove();\n                            $edit.replaceWith($input);\n                            $input.focus();\n                        });\n\n                        $form.append($edit);\n                    }\n\n                    var $cancel = create_command('cancel');\n                    $cancel.on('click', function() {\n                        $form.remove();\n                        $commands.find('a').show();\n                    });\n                    $form.append($cancel);\n\n                    $commands.find('a').each(function() {\n                        $(this).hide();\n                    });\n                    $commands.append($form);\n                };\n\n                /**\n                 *  On move command clicked\n                 *\n                 *  @param {DOMEventFacade} e\n                 */\n                $.on_move = function(e) {\n                    var $item = $(e.target).closest('li.activity');\n                    var id = $item.attr('id').match(/(\\d+)$/)[1];\n\n                    move_targets.show(id);\n                };\n\n                /**\n                 *  On delete command clicked\n                 *\n                 *  @param {DOMEventFacade} e\n                 */\n                $.on_delete = function(e) {\n                    var $item = $(e.target).closest('li');\n                    var liText = $item[0].innerText;\n\n                    var isDirectory = false;\n                    var modalBody;\n                    var item;\n                    var description_text = '';\n\n                    if ($item.hasClass(\"directory\")) {\n                        isDirectory = true;\n                        item = str('folder_string');\n                        description_text = str('delete_folder');\n                    } else {\n                        item = str('activity_string');\n                    }\n\n                    modalBody = '<p class=\"delete-item\">' + item + ' ' + liText + description_text + '</p>';\n\n                    confirm_modal({\n                        'title': str('confirm_delete'),\n                        'body': modalBody,\n                        'save_button': str('modal_confirm_delete'),\n                        'checkbox': false,\n                        'next': function() {\n\n                            var data = {};\n\n                            if (isDirectory === true) {\n                                data = {\n                                    \"action\": \"delete_directory\",\n                                    \"path\": $item.attr(\"directory-path\"),\n                                    \"sesskey\": M.cfg.sesskey\n                                };\n                            } else if ($item.hasClass(\"activity\")) {\n                                data = {\n                                    \"action\": \"delete\",\n                                    \"id\": $item.attr('id').match(/(\\d+)$/)[1],\n                                    \"sesskey\": M.cfg.sesskey\n                                };\n                            }\n\n                            var $spinner = add_spinner();\n\n                            $.post(get_action_url(\"rest\"), data,\n                                function() {\n                                    reload_tree();\n                                })\n                                .fail(function(response) {\n                                    show_error(response);\n                                })\n                                .always(function() {\n                                    $spinner.hide();\n                                });\n\n                            e.stopPropagation();\n                        }\n                    });\n                };\n\n                /**\n                 *  On restore command clicked\n                 *\n                 *  @param {DOMEventFacade} e\n                 */\n                $.on_restore = function(e) {\n                    var $item = $(e.target).closest('li');\n                    var id = null;\n\n                    if ($item.hasClass(\"directory\")) {\n                        id = $item.attr(\"directory-path\");\n                        restore_targets.is_directory = true;\n                    } else if ($item.hasClass(\"activity\")) {\n                        id = $item.attr('id').match(/(\\d+)$/)[1];\n                        restore_targets.is_directory = false;\n                    }\n\n                    restore_targets.show(id);\n                };\n\n                /**\n                 * On backup the whole section as a folder\n                 *\n                 * @param {int} sectionId\n                 * @param {int} sectionNumber\n                 * @param {int} courseId\n                 * @param {string} sectionName\n                 */\n                $.on_section_backup = function(sectionId, sectionNumber, courseId, sectionName) {\n                    var data =\n                        {\n                            \"action\": \"is_userdata_copyable_section\",\n                            \"sectionid\": sectionId,\n                            \"sectionnumber\": sectionNumber,\n                            \"courseid\": courseId,\n                        };\n\n                    var body_html = '<p class=\"alert alert-danger mt-3\">' + str('backup_heavy_load_warning_message') +\n                        '</p>' + str('confirm_backup_section');\n\n                    on_backup_modal(data, sectionName, body_html, true);\n                };\n\n                /**\n                 *  Initialize the delete bulk\n                 */\n                $.init_bulk_delete = function(isspeciallayout) {\n                    var bulkdelete = $block.find('.editing_bulkdelete');\n                    if (bulkdelete.length) {\n                        if (isspeciallayout) {\n                            bulkdelete.attr('role', 'menuitem').addClass('dropdown-item menu-action');\n                            bulkdelete.append($(\"<span class='menu-action-text'/>\").append(bulkdelete.attr('title')));\n\n                            $block.find('.menubar .dropdown .dropdown-menu').append(bulkdelete);\n                        } else {\n                            $block.find('.header .commands').append(bulkdelete);\n                        }\n                    }\n                };\n\n                /**\n                 *  Initialize the help icon\n                 */\n                $.init_help_icon = function(isspeciallayout) {\n                    var helpicon = $block.find('.header-commands > .help-icon');\n\n                    if (isspeciallayout) {\n                        $block.find('.header-commands').parent().css('display', 'block');\n                    } else {\n                        $block.find('.header .commands').append(helpicon);\n                    }\n                };\n\n                /**\n                 *  Initialize the Sharing Cart block header\n                 */\n                $.init_block_header = function() {\n                    var isspeciallayout = verify_layout();\n                    $.init_bulk_delete(isspeciallayout);\n                    $.init_help_icon(isspeciallayout);\n                };\n\n                /**\n                 *  Initialize the Sharing Cart item tree\n                 */\n                $.init_item_tree = function() {\n                    function add_actions(item, actions) {\n                        var $item = $(item);\n                        var $commands = $item.find('.commands').first();\n\n                        $.each(actions, function(index, action) {\n                            var $command = create_command(action);\n                            $command.on('click', function(e) {\n                                $['on_' + action](e);\n                            });\n                            $commands.append($command);\n                        }, this);\n                    }\n\n                    var activity_actions = ['movedir', 'move', 'delete'];\n                    if (course) {\n                        activity_actions.push('restore');\n                    }\n\n                    var directory_actions = ['delete', 'restore'];\n\n                    // Initialize items\n                    $block.find('li.activity').each(function(index, item) {\n                        if($(item).attr('data-disable-copy') == 1) {\n                            add_actions(item, ['movedir', 'move', 'delete']);\n                            return;\n                        }\n                        add_actions(item, activity_actions);\n                    });\n\n                    // Initialize directory items\n                    $block.find('li.directory').each(function(index, item) {\n                        add_actions(item, directory_actions);\n                    });\n\n                    // Initialize directories\n                    directories.init();\n                };\n\n                /**\n                 * Extract html object from area where moodle ajax was called.\n                 *\n                 * Call add_activity_backup_control to re append sharing cart icon.\n                 */\n                $.init_activity_commands = function() {\n                    $(document).ajaxComplete(function(event, xhr, settings) {\n\n                        var url = settings.url;\n                        var lastslashindex = url.lastIndexOf('=');\n                        var result = url.substring(lastslashindex + 1);\n\n                        if (result === 'core_course_edit_module' || result === 'core_course_get_module') {\n\n                            var data = JSON.parse(settings.data);\n                            var action = data[0].args.action;\n\n                            // Don't try to add icon if activity has been deleted.\n                            if (action === 'delete') {\n                                return;\n                            }\n\n                            setTimeout(function() {\n                                var activity_id = data[0].args.id;\n                                var activity = $('#module-' + activity_id);\n                                add_activity_backup_control(activity);\n\n                                if (action === 'duplicate') {\n                                    var duplicated = activity.next();\n                                    add_activity_backup_control(duplicated);\n                                }\n                            }, 1);\n                        }\n                    });\n\n                    /**\n                     * Create the backup icon\n                     *\n                     * @returns $backupIcon\n                     */\n                    function create_backup_icon() {\n\n                        var $backupIcon = $('<a href=\"javascript:void(0)\" class=\"add-to-sharing-cart\" />')\n                            .append($('<i class=\"fa fa-shopping-basket icon\"></i>'))\n                            .attr('title', str('backup'));\n\n                        if (addMethod !== 'click_to_add') {\n                            $backupIcon.addClass('d-none');\n                        }\n\n                        return $backupIcon;\n                    }\n\n                    /**\n                     * Add backup control with a click event to an activity\n                     * Added fix for copying an activity without backup routine\n                     *\n                     * @param $activity\n                     */\n                    function add_activity_backup_control($activity) {\n\n                        var activityClass = $activity[0].className;\n\n                        // Selecting modtype without prefix.\n                        var modtype = activityClass.substr(activityClass.indexOf('modtype_') + 8);\n\n                        // Default activity name.\n                        var activityName = str('activity_string');\n\n                        // Label is using a different html / css layout, so it's needed to get the name by using another $find.\n                        if (modtype !== 'label') {\n                            activityName = $('.activity#' + $activity[0].id)\n                                .find('.mod-indent-outer .activityinstance span.instancename')\n                                .html();\n                        }\n\n                        var $backupIcon = create_backup_icon();\n\n                        $backupIcon.on('click', function(e) {\n                            $.on_backup(e, activityName);\n                        });\n\n                        var $actionMenuItem = $activity.find('.action-menu.section-cm-edit-actions').parent('.actions');\n\n                        if (!$actionMenuItem.find('.add-to-sharing-cart').length) {\n                            $actionMenuItem.append($backupIcon);\n                        }\n                    }\n\n                    /**\n                     * Add backup control with a click event to a section\n                     *\n                     * @param $section\n                     */\n                    function add_section_backup_control($section) {\n\n                        var sectionId = $section.find('.section_action_menu').data('sectionid');\n                        var sectionNumber = parseInt(String($section.attr('id')).match(/\\d+/)[0]);\n                        var sectionName = $section.attr('aria-label') || $section.find('.sectionname').text().trim();\n\n                        var isFlexibleCourseFormat = $('body[id$=flexsections]').length;\n\n                        // Extract the section ID from the section if this is a Flexible\n                        // course format (since this format doesn't have an action menu)\n                        if (isFlexibleCourseFormat && (typeof sectionId === 'undefined' || sectionId === null)) {\n                            sectionId = $section.data('section-id');\n                        }\n\n                        // A bit unsafe to extract the course ID from the body but it's the best option we got at the moment\n                        var courseId = parseInt(String($('body').attr('class')).match(/course-([0-9]*)( |$)/)[1]);\n\n                        var $backupIcon = create_backup_icon();\n\n                        $backupIcon.on('click', function() {\n                            var inPlaceEditSectionName = in_place_edit_section_name($section);\n                            sectionName = (inPlaceEditSectionName !== '') ? inPlaceEditSectionName : sectionName;\n                            $.on_section_backup(sectionId, sectionNumber, courseId, sectionName);\n                        });\n\n                        var $sectionTitle = $section.find('h3.sectionname').first().find('a').last();\n\n                        var $inPlaceEditable = $section.find('h3.sectionname .inplaceeditable').first();\n                        if ($inPlaceEditable.length) {\n                            $sectionTitle = $inPlaceEditable;\n                        }\n\n                        // Add the backup icon after the cog wheel if this is a Flexible course format\n                        if (isFlexibleCourseFormat && sectionNumber === 0) {\n                            $sectionTitle = $section.find('> .controls');\n                            $sectionTitle.prepend($backupIcon);\n                        } else {\n                            $backupIcon.insertAfter($sectionTitle);\n                        }\n\n                        var activitySelector = 'li.activity';\n\n                        var $activities = $section.find(activitySelector);\n\n                        $($activities).each(function() {\n                            add_activity_backup_control($(this));\n                        });\n                    }\n\n                    $(\"body.editing .course-content li.section\").each(function() {\n                        add_section_backup_control($(this));\n                    });\n                };\n\n                /**\n                 *  Initialize the Sharing Cart footer basket for 4.0+.\n                 */\n                function init_footer_basket() {\n                    let currentDragging;\n                    const activities = document.querySelectorAll(\".activity.activity-wrapper\");\n                    const sections = document.querySelectorAll(\".course-section-header\");\n                    const sharingCartBlock = document.querySelector('section[data-block=\"sharing_cart\"]');\n\n                    add_draggable_to_first_section();\n\n                    const footer = document.getElementById('page-footer');\n                    const footerIconContainer = footer.querySelector('div[data-region=\"footer-container-popover\"]');\n\n                    var basket = document.createElement('i');\n                    basket.setAttribute('class', 'fa fa-shopping-basket');\n\n                    var basketButton = document.createElement('button');\n                    basketButton.setAttribute('class', 'btn btn-icon bg-secondary icon-no-margin btn-footer-popover sharing_cart_basket');\n                    basketButton.setAttribute('style', 'z-index: 1001;');\n                    basketButton.append(basket);\n\n                    var dropAreaText = document.createElement('p');\n                    dropAreaText.setAttribute('class', 'font-weight-bold text-white');\n                    dropAreaText.innerText = str('drop_here');\n\n                    var dropArea = document.createElement('div');\n                    dropArea.setAttribute('class',\n                        'h-100 w-100 position-absolute d-flex justify-content-center align-items-center');\n                    dropArea.append(dropAreaText);\n\n                    sections.forEach(section => {\n                        drag_event_listeners(section);\n                    });\n\n                    activities.forEach(activity => {\n                        drag_event_listeners(activity);\n                    });\n\n                    /**\n                     *  Initialize events for dragging\n                     * @param {object} draggable\n                     */\n                    function drag_event_listeners(draggable) {\n                        draggable.addEventListener('dragstart', (e) => {\n                            basketButton.classList.remove('shake_basket');\n\n                            footerIconContainer?.prepend(basketButton);\n                            sharingCartBlock.children[0].classList.add('dragging_item');\n                            sharingCartBlock.append(dropArea);\n                            currentDragging = e.target;\n                            isDragging = true;\n                        });\n\n                        draggable.addEventListener('dragend', () => {\n                            if (currentDragging instanceof HTMLElement) {\n                                footerIconContainer?.removeChild(basketButton);\n                            }\n\n                            sharingCartBlock.children[0].classList.remove('dragging_item');\n                            sharingCartBlock.removeChild(dropArea);\n                            isDragging = false;\n                        });\n                    }\n\n                    [basketButton, sharingCartBlock].forEach((dropzone) => {\n                        dropzone.addEventListener(\"dragover\", (e) => {\n                            e.preventDefault();\n                            dropzone.classList.add('drag_over');\n                        });\n\n                        dropzone.addEventListener(\"dragenter\", (e) => {\n                            e.preventDefault();\n                            dropzone.classList.add('drag_over');\n                        });\n\n                        dropzone.addEventListener(\"dragleave\", () => {\n                            dropzone.classList.remove('drag_over');\n                        });\n\n                        dropzone.addEventListener(\"drop\", () => {\n                            if (currentDragging instanceof HTMLElement) {\n                                currentDragging.querySelector('.add-to-sharing-cart').click();\n                            }\n\n                            dropzone.classList.remove('drag_over');\n                            currentDragging = undefined;\n                            isDragging = false;\n                        });\n                    });\n                }\n\n                /**\n                 *  Make the first section (General) draggable\n                 */\n                function add_draggable_to_first_section() {\n                    const courseSectionHeader = document.getElementsByClassName(\"course-section-header\")[0] ?? null;\n\n                    if (courseSectionHeader instanceof HTMLElement) {\n                        courseSectionHeader.classList.add('draggable');\n                        courseSectionHeader.setAttribute('draggable', true);\n                    }\n                }\n\n                /**\n                 * Initialize the Sharing Cart block\n                 */\n                $.init = function() {\n                    M.str.block_sharing_cart.pluginname = this.get_plugin_name();\n\n                    // Arrange header icons (bulkdelete, help)\n                    $.init_block_header();\n                    $.init_item_tree();\n                    $.init_activity_commands();\n\n                    if (addMethod === 'drag_and_drop') {\n                        init_footer_basket();\n                    }\n                };\n                var $spinner = $('<i/>').addClass('spinner fa fa-3x fa-circle-o-notch fa-spin');\n                $('div#sharing-cart-spinner-modal div.spinner-container').prepend($spinner);\n\n                $.init();\n            });\n\n            $('.copy_section').on('click', function() {\n\n                var $section_selected = ($('.section-dropdown option:selected'));\n                var sectionId = $section_selected.data('section-id');\n                var sectionNumber = $section_selected.data('section-number');\n                var courseId = $section_selected.data('course-id');\n                var sectionName = $section_selected.data('section-name');\n\n                $.on_section_backup(sectionId, sectionNumber, courseId, sectionName);\n            });\n\n            $('.copy_activity').on('click', function(e) {\n                var activitySelected = ($('.activity-dropdown option:selected'));\n                var activityId = activitySelected.data('activity-id');\n                var activityName = activitySelected.data('activity-name');\n\n                $.on_backup(e, activityName, activityId);\n            });\n        }\n    };\n});\n"],"names":["define","$","ModalFactory","ModalEvents","init","addMethod","document","ready","isDragging","str","identifier","M","block_sharing_cart","moodle","get_action_url","name","args","url","cfg","wwwroot","q","k","push","encodeURIComponent","join","remove_basket","footerIconContainer","getElementById","querySelector","sharingCartBasket","removeChild","classList","remove","confirm_modal","obj","checkbox","body","create","type","types","SAVE_CANCEL","title","done","modal","is_submitted","setSaveButtonText","save_button","getRoot","on","save","e","response","target","find","is","next","cancel","hidden","removeClass","show","in_place_edit_section_name","$section","sectionName","$inPlaceEditable","length","data","on_backup_modal","post_data","title_str","body_str","isSection","post","copyable","sectionId","sectionNumber","courseId","userdata","$commands","closest","attr","text","trim","String","parent","inPlaceEditSectionName","$spinner","add_spinner","$node_spinner","add_node_spinner","action","sectionid","sectionnumber","courseid","sectionname","sesskey","reload_tree","fail","show_error","always","hide","backup_section","cmid","course","id","backup","add","shake_basket","on_success","icon","css","iconClass","movedir","move","edit","delete","restore","$block","this","match","is_frontpage","hasClass","ex","JSON","parse","responseText","core","exception","message","create_command","iconElement","addClass","append","$node","replaceWith","init_item_tree","directories","param","readCookie","KEY","opens","cookie","pop","split","map","v","parseInt","expires","Date","setDate","getDate","value","expireTimeInMillisecond","d","setTime","getTime","toUTCString","setCookie","open","$dir","visible","i","each","index","dir","toggle","reset","move_targets","$cancel","targets","$target","item_id","$current","$next","$list","next_id","create_target","area_to","$anchor","m","item","$item","to","before","restore_targets","is_directory","$clipboard","section","href","directory","in_section","returnurl","URL","util","image_url","$view","html","prepend","cloneNode","replace","$sitetopic","$mainmenu","$container","format","get_section_wrapper","sectionDOM","first","init_footer_basket","currentDragging","activities","querySelectorAll","sections","sharingCartBlock","courseSectionHeader","getElementsByClassName","HTMLElement","setAttribute","add_draggable_to_first_section","basket","createElement","basketButton","dropAreaText","innerText","dropArea","drag_event_listeners","draggable","addEventListener","children","forEach","activity","dropzone","preventDefault","click","undefined","get_plugin_name","$blockheader","on_backup","activityName","cmId","arguments","$backup","$activity","dataowner","on_movedir","$current_dir","current_path","dirs","$form","submit","folder_to","val","$input","setTimeout","focus","unshift","$select","change","$edit","on_move","on_delete","modalBody","liText","isDirectory","description_text","path","stopPropagation","on_restore","on_section_backup","init_bulk_delete","isspeciallayout","bulkdelete","init_help_icon","helpicon","init_block_header","add_actions","actions","$command","activity_actions","directory_actions","init_activity_commands","create_backup_icon","$backupIcon","add_activity_backup_control","activityClass","className","modtype","substr","indexOf","$actionMenuItem","ajaxComplete","event","xhr","settings","lastslashindex","lastIndexOf","result","substring","activity_id","isFlexibleCourseFormat","$sectionTitle","last","insertAfter","$activities","add_section_backup_control","pluginname","$section_selected","activitySelected","activityId"],"mappings":"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"}